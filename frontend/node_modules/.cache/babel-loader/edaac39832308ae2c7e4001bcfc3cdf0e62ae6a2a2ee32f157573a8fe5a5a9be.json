{"ast":null,"code":"import _objectSpread from\"c:/Users/User/Downloads/REDDYS/ECOMM-R/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useState,useEffect,useCallback}from'react';const getDistanceFromLatLonInKm=(lat1,lon1,lat2,lon2)=>{const R=6371;// Radius of the earth in km\nconst deg2rad=deg=>deg*(Math.PI/180);const dLat=deg2rad(lat2-lat1);const dLon=deg2rad(lon2-lon1);const a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(deg2rad(lat1))*Math.cos(deg2rad(lat2))*Math.sin(dLon/2)*Math.sin(dLon/2);const c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return R*c;// Distance in km\n};export const useProductCategory=(categoryName,searchQuery)=>{const[products,setProducts]=useState([]);const[filteredProducts,setFilteredProducts]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const addDistanceToProducts=useCallback((prods,userLat,userLon)=>{return prods.map(product=>{if(product.lat&&product.lon){const distance=getDistanceFromLatLonInKm(userLat,userLon,product.lat,product.lon);return _objectSpread(_objectSpread({},product),{},{distance:\"\".concat(distance.toFixed(1),\" km away\")});}return _objectSpread(_objectSpread({},product),{},{distance:'Distance N/A'});});},[]);useEffect(()=>{const fetchProducts=async()=>{try{setLoading(true);const response=await fetch(\"http://localhost:5000/api/products/category/\".concat(categoryName));if(response.ok){let data=await response.json();setProducts(data);setFilteredProducts(data);// Initially set filtered to all\n}else{setError(\"Failed to load \".concat(categoryName,\" products\"));}}catch(err){setError(err.message);}finally{setLoading(false);}};fetchProducts();},[categoryName]);useEffect(()=>{if(products.length>0&&navigator.geolocation){navigator.geolocation.getCurrentPosition(position=>{const userLat=position.coords.latitude;const userLon=position.coords.longitude;const productsWithDistance=addDistanceToProducts(products,userLat,userLon);setProducts(productsWithDistance);setFilteredProducts(productsWithDistance);},()=>{// On error, just use products without distance\nsetFilteredProducts(products.map(p=>_objectSpread(_objectSpread({},p),{},{distance:'Within 5km'})));});}},[products,addDistanceToProducts]);useEffect(()=>{setFilteredProducts(products.filter(p=>p.name.toLowerCase().includes(searchQuery.toLowerCase())));},[searchQuery,products]);return{filteredProducts,loading,error};};","map":{"version":3,"names":["useState","useEffect","useCallback","getDistanceFromLatLonInKm","lat1","lon1","lat2","lon2","R","deg2rad","deg","Math","PI","dLat","dLon","a","sin","cos","c","atan2","sqrt","useProductCategory","categoryName","searchQuery","products","setProducts","filteredProducts","setFilteredProducts","loading","setLoading","error","setError","addDistanceToProducts","prods","userLat","userLon","map","product","lat","lon","distance","_objectSpread","concat","toFixed","fetchProducts","response","fetch","ok","data","json","err","message","length","navigator","geolocation","getCurrentPosition","position","coords","latitude","longitude","productsWithDistance","p","filter","name","toLowerCase","includes"],"sources":["c:/Users/User/Downloads/REDDYS/ECOMM-R/frontend/src/Customer/Categories/Products/Jewllery/useProductCategory.js"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\n\r\nconst getDistanceFromLatLonInKm = (lat1, lon1, lat2, lon2) => {\r\n    const R = 6371; // Radius of the earth in km\r\n    const deg2rad = (deg) => deg * (Math.PI / 180);\r\n    const dLat = deg2rad(lat2 - lat1);\r\n    const dLon = deg2rad(lon2 - lon1);\r\n    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLon / 2) * Math.sin(dLon / 2);\r\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n    return R * c; // Distance in km\r\n};\r\n\r\nexport const useProductCategory = (categoryName, searchQuery) => {\r\n    const [products, setProducts] = useState([]);\r\n    const [filteredProducts, setFilteredProducts] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState(null);\r\n\r\n    const addDistanceToProducts = useCallback((prods, userLat, userLon) => {\r\n        return prods.map(product => {\r\n            if (product.lat && product.lon) {\r\n                const distance = getDistanceFromLatLonInKm(userLat, userLon, product.lat, product.lon);\r\n                return { ...product, distance: `${distance.toFixed(1)} km away` };\r\n            }\r\n            return { ...product, distance: 'Distance N/A' };\r\n        });\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const fetchProducts = async () => {\r\n            try {\r\n                setLoading(true);\r\n                const response = await fetch(`http://localhost:5000/api/products/category/${categoryName}`);\r\n                if (response.ok) {\r\n                    let data = await response.json();\r\n                    setProducts(data);\r\n                    setFilteredProducts(data); // Initially set filtered to all\r\n                } else {\r\n                    setError(`Failed to load ${categoryName} products`);\r\n                }\r\n            } catch (err) {\r\n                setError(err.message);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        fetchProducts();\r\n    }, [categoryName]);\r\n\r\n    useEffect(() => {\r\n        if (products.length > 0 && navigator.geolocation) {\r\n            navigator.geolocation.getCurrentPosition(\r\n                (position) => {\r\n                    const userLat = position.coords.latitude;\r\n                    const userLon = position.coords.longitude;\r\n                    const productsWithDistance = addDistanceToProducts(products, userLat, userLon);\r\n                    setProducts(productsWithDistance);\r\n                    setFilteredProducts(productsWithDistance);\r\n                },\r\n                () => { // On error, just use products without distance\r\n                    setFilteredProducts(products.map(p => ({...p, distance: 'Within 5km' })));\r\n                }\r\n            );\r\n        }\r\n    }, [products, addDistanceToProducts]);\r\n\r\n    useEffect(() => {\r\n        setFilteredProducts(products.filter(p => p.name.toLowerCase().includes(searchQuery.toLowerCase())));\r\n    }, [searchQuery, products]);\r\n\r\n    return { filteredProducts, loading, error };\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}